
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Getting started &#8212; PHES-ODM Validation  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/odm-styles.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Getting to know the validation library" href="explanation-document/explanation-document.html" />
    <link rel="prev" title="PHES-ODM Validation Documentation" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<p>The ODM-validation library provides an easy way of checking that your
data is ODM-compliant by validating it against a rule-based schema.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>The first step is to install the package. You can find instructions
<a class="reference internal" href="../index-content.html#installation"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="code-setup">
<h2>Code setup<a class="headerlink" href="#code-setup" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># stdlib</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>  <span class="c1"># for constructing file paths</span>

<span class="c1"># odm-validation</span>
<span class="kn">import</span> <span class="nn">odm_validation.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">odm_validation.validation</span> <span class="kn">import</span> <span class="n">generate_validation_schema</span><span class="p">,</span> <span class="n">validate_data</span>

<span class="c1"># our asset directory</span>
<span class="n">ASSET_DIR</span> <span class="o">=</span> <span class="s2">&quot;../../assets/&quot;</span>
</pre></div>
</div>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this heading">¶</a></h2>
<p>To run the validation you will need your own dataset as a CSV file, and
a validation schema specific to the version of the ODM you’re using.</p>
<p>In this example we’ll validate a table of samples with the default
schema. The <code class="docutils literal notranslate"><span class="pre">validate_data</span></code> can take multiple tables at once, so we
include our sample table in a Python dictionary with the table name as
the key. We are validating the <code class="docutils literal notranslate"><span class="pre">samples</span></code> table in this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ASSET_DIR</span><span class="p">,</span> <span class="s2">&quot;validation-schemas/schema-v2.0.0-rc.1.yml&quot;</span><span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">import_schema</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">import_dataset</span><span class="p">(</span><span class="s2">&quot;samples.csv&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">samples</span><span class="p">}</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">validate_data</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of errors: &quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">report</span><span class="o">.</span><span class="n">valid</span><span class="p">()</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">errors</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>number of errors:  0
</pre></div>
</div>
<p>Our sample dataset has been validated successfully with no errors.</p>
<p>Now let’s see what happens when validating invalid data. We’ll use the
same schema, but replace the previous dataset with an invalid one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">import_dataset</span><span class="p">(</span><span class="s2">&quot;samples-invalid.csv&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">samples</span><span class="p">}</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">validate_data</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>The validation report contains a list of errors from all instances of
broken rules. Each error is a dictionary with information of what went
wrong and where. The message-field has a human-readable summary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">report</span><span class="o">.</span><span class="n">valid</span><span class="p">()</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">report</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Invalid category flowPr1 found in row 1 for column coll in table samples
</pre></div>
</div>
<p>The error message starts with the name of the rule that has been broken,
followed by the table name, field name, and row number. The actual
format of the message varies from rule to rule, but the general idea is
the same.</p>
<p>To find out the requirements for each rule, you can read the
specifications in the
<a class="reference external" href="https://github.com/Big-Life-Lab/PHES-ODM-Validation/tree/6-jupyter-example/validation-rules">validation-rules</a>
directory.</p>
</section>
<section id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this heading">¶</a></h2>
<p>ODM version information is an important part of the validation report.
Consecutive validations by different people may give different results
depending on their validation-package version, schema version, etc. This
may be avoided by looking at the versions included in the report. If two
reports from the same data have differing versions, then the errors
reported may differ too.</p>
<p>The package version is set automatically, but the schema and data
versions should be specified. The latest version is used by default when
not specified.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">package_version</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">schema_version</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">data_version</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.1.0
2.0.0-rc.1
2.0.0-rc.1
</pre></div>
</div>
</section>
<section id="schema-generation">
<h2>Schema generation<a class="headerlink" href="#schema-generation" title="Permalink to this heading">¶</a></h2>
<p>You can generate your own validation schema from a CSV file of the parts
table, using the <code class="docutils literal notranslate"><span class="pre">generate_validation_schema</span></code> function. The version
parameter determines which version of the ODM the schema will be
compatible with.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;2.0.0-rc.1&#39;</span>
<span class="n">parts_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ASSET_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;dictionary/v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/parts.csv&quot;</span><span class="p">)</span>
<span class="n">parts</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">import_dataset</span><span class="p">(</span><span class="n">parts_file</span><span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">generate_validation_schema</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting schema can also be exported to a YAML file for future use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">utils</span><span class="o">.</span><span class="n">export_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;my_schema.yml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ODM-logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">PHES-ODM Validation</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-setup">Code setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation">Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema-generation">Schema generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="explanation-document/explanation-document.html">Getting to know the validation library</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema-additions/schema-additions.html">Customizing a Validation Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rules.html">Validation rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links/contributing_link.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links/code_of_conduct_link.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links/license_link.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">PHES-ODM Validation Documentation</a></li>
      <li>Next: <a href="explanation-document/explanation-document.html" title="next chapter">Getting to know the validation library</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, OHRI.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/examples/tutorial.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>